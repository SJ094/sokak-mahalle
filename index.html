<script>
/* ===============================
   SOKAK VERÄ°TABANI
================================ */
const sokaklar = {
  "yemeni sokak": "ErtuÄŸrul Gazi Mahallesi",
  "Ã§ayÄ±r sokak": "DumlupÄ±nar Mahallesi",
  "sekbanlÄ± sokak": "Ataevler Mahallesi",
  "gÃ¶ksun sokak": "Ä°stasyon Mahallesi",
  "cami sokak": "Tepecik Mahallesi"
};

let dinliyor = false;

/* ===============================
   NORMALIZE (yemeni / yemeni sk / yemeni sok)
================================ */
function normalize(text) {
  return text
    .toLowerCase()
    .replace(/sok\.?/g, "sokak")
    .replace(/sk/g, "sokak")
    .replace(/\s+/g, " ")
    .trim();
}

/* ===============================
   ENTER Ä°LE ARAMA
================================ */
document.getElementById("sokakInput").addEventListener("keypress", function (e) {
  if (e.key === "Enter") ara();
});

/* ===============================
   ANA ARAMA FONKSÄ°YONU
================================ */
function ara() {
  const inputEl = document.getElementById("sokakInput");
  const resultDiv = document.getElementById("result");

  if (!inputEl || !resultDiv) return;

  const girilen = inputEl.value;
  const aranan = normalize(girilen);

  if (!aranan) {
    gosterSonuc("error", "âŒ UyarÄ±", "LÃ¼tfen bir sokak adÄ± girin!");
    return;
  }

  /* 1ï¸âƒ£ TAM EÅLEÅME */
  if (sokaklar[aranan]) {
    gosterSonuc(
      "success",
      "âœ… Bulundu!",
      `<div class="sokak-name">${girilen}</div>
       <div class="mahalle-name">${sokaklar[aranan]}</div>`
    );
    sesliSoyle(sokaklar[aranan]);
    return;
  }

  /* 2ï¸âƒ£ KISMÄ° EÅLEÅME (yemeni â†’ yemeni sokak) */
  const eslesenSokak = Object.keys(sokaklar).find(sokak =>
    sokak.includes(aranan) || aranan.includes(sokak.replace(" sokak", ""))
  );

  if (eslesenSokak) {
    gosterSonuc(
      "success",
      "âœ… Bulundu!",
      `<div class="sokak-name">${eslesenSokak}</div>
       <div class="mahalle-name">${sokaklar[eslesenSokak]}</div>`
    );
    sesliSoyle(sokaklar[eslesenSokak]);
  } else {
    gosterSonuc(
      "warning",
      "âš ï¸ BulunamadÄ±",
      "Bu sokak veritabanÄ±nda bulunamadÄ±."
    );
    sesliSoyle("BulunamadÄ±");
  }
}

/* ===============================
   SESLÄ° OKUMA
================================ */
function sesliSoyle(metin) {
  window.speechSynthesis.cancel();
  const utterance = new SpeechSynthesisUtterance(metin);
  utterance.lang = "tr-TR";
  utterance.rate = 1.1;
  window.speechSynthesis.speak(utterance);
}

/* ===============================
   SESLÄ° ARAMA
================================ */
function sesliAra() {
  const SpeechRecognition =
    window.SpeechRecognition || window.webkitSpeechRecognition;

  if (!SpeechRecognition) {
    gosterSonuc("error", "âŒ Hata", "TarayÄ±cÄ± ses tanÄ±mayÄ± desteklemiyor.");
    return;
  }

  const recognition = new SpeechRecognition();
  recognition.lang = "tr-TR";
  recognition.continuous = false;
  recognition.interimResults = false;

  const voiceBtn = document.getElementById("voiceBtn");

  recognition.onstart = () => {
    dinliyor = true;
    voiceBtn.classList.add("listening");
    voiceBtn.textContent = "ğŸ”´";
    gosterSonuc("listening", "ğŸ¤ Dinliyorum", "Sokak adÄ±nÄ± sÃ¶yleyin...");
  };

  recognition.onresult = (event) => {
    const sesliMetin = event.results[0][0].transcript;
    document.getElementById("sokakInput").value = sesliMetin;
    ara();
  };

  recognition.onerror = () => {
    gosterSonuc("error", "âŒ Hata", "Ses tanÄ±ma hatasÄ±.");
  };

  recognition.onend = () => {
    dinliyor = false;
    voiceBtn.classList.remove("listening");
    voiceBtn.textContent = "ğŸ¤";
  };

  recognition.start();
}

/* ===============================
   TEMÄ°ZLE
================================ */
function temizle() {
  document.getElementById("sokakInput").value = "";
  document.getElementById("result").classList.add("hidden");
}

/* ===============================
   SOKAK LÄ°STESÄ°
================================ */
function sokakListesiOlustur() {
  const liste = document.getElementById("sokakListesi");
  if (!liste) return;

  liste.innerHTML = "";
  Object.entries(sokaklar).forEach(([sokak, mahalle]) => {
    const item = document.createElement("div");
    item.className = "list-item";
    item.innerHTML = `
      <div class="list-sokak">${sokak}</div>
      <div class="list-mahalle">${mahalle}</div>
    `;
    liste.appendChild(item);
  });
}

/* ===============================
   SAYFA YÃœKLENÄ°NCE
================================ */
sokakListesiOlustur();
</script>
