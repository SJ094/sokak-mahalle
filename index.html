<script>
document.addEventListener("DOMContentLoaded", function () {

  /* ===============================
     SOKAK VERƒ∞TABANI
  ================================ */
  const sokaklar = {
    'yemeni sokak': 'Ertuƒürul Gazi Mahallesi',
    '√ßayƒ±r sokak': 'Dumlupƒ±nar Mahallesi',
    'sekbanlƒ± sokak': 'Ataevler Mahallesi',
    'g√∂ksun sokak': 'ƒ∞stasyon Mahallesi',
    'cami sokak': 'Tepecik Mahallesi'
  };

  let dinliyor = false;

  /* ===============================
     NORMALIZE
  ================================ */
  function normalize(text) {
    return text
      .toLowerCase()
      .replace(/sok\.?/g, 'sokak')
      .replace(/sk/g, 'sokak')
      .replace(/\s+/g, ' ')
      .trim();
  }

  /* ===============================
     ENTER ƒ∞LE ARAMA
  ================================ */
  const sokakInput = document.getElementById("sokakInput");
  const resultDiv = document.getElementById("result");
  const voiceBtn = document.getElementById("voiceBtn");

  sokakInput.addEventListener("keypress", function (e) {
    if (e.key === "Enter") ara();
  });

  /* ===============================
     ANA ARAMA
  ================================ */
  window.ara = function () {
    const girilen = sokakInput.value;
    const aranan = normalize(girilen);

    if (!aranan) {
      gosterSonuc('error', '‚ùå Uyarƒ±', 'L√ºtfen bir sokak adƒ± girin!');
      return;
    }

    // 1Ô∏è‚É£ Tam e≈üle≈üme
    if (sokaklar[aranan]) {
      gosterSonuc(
        'success',
        '‚úÖ Bulundu!',
        `<div class="sokak-name">${girilen}</div>
         <div class="mahalle-name">${sokaklar[aranan]}</div>`
      );
      sesliSoyle(sokaklar[aranan]);
      return;
    }

    // 2Ô∏è‚É£ Kƒ±smi e≈üle≈üme (yemeni ‚Üí yemeni sokak)
    const eslesen = Object.keys(sokaklar).find(sokak =>
      sokak.includes(aranan) ||
      aranan.includes(sokak.replace(' sokak', ''))
    );

    if (eslesen) {
      gosterSonuc(
        'success',
        '‚úÖ Bulundu!',
        `<div class="sokak-name">${eslesen}</div>
         <div class="mahalle-name">${sokaklar[eslesen]}</div>`
      );
      sesliSoyle(sokaklar[eslesen]);
    } else {
      gosterSonuc(
        'warning',
        '‚ö†Ô∏è Bulunamadƒ±',
        'Bu sokak veritabanƒ±nda bulunamadƒ±.'
      );
      sesliSoyle('Bulunamadƒ±');
    }
  };

  /* ===============================
     SESLƒ∞ OKUMA
  ================================ */
  function sesliSoyle(metin) {
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(metin);
    u.lang = 'tr-TR';
    u.rate = 1.1;
    window.speechSynthesis.speak(u);
  }

  /* ===============================
     SESLƒ∞ ARAMA
  ================================ */
  window.sesliAra = function () {
    const SpeechRecognition =
      window.SpeechRecognition || window.webkitSpeechRecognition;

    if (!SpeechRecognition) {
      gosterSonuc('error', '‚ùå Uyarƒ±', 'Tarayƒ±cƒ± ses tanƒ±mayƒ± desteklemiyor.');
      return;
    }

    const recognition = new SpeechRecognition();
    recognition.lang = 'tr-TR';

    recognition.onstart = () => {
      voiceBtn.classList.add('listening');
      voiceBtn.textContent = 'üî¥ Dinliyor...';
      gosterSonuc('listening', 'üé§ Dinliyorum', 'Sokak adƒ±nƒ± s√∂yleyin...');
    };

    recognition.onresult = (e) => {
      const metin = e.results[0][0].transcript;
      sokakInput.value = metin;
      ara();
    };

    recognition.onend = () => {
      voiceBtn.classList.remove('listening');
      voiceBtn.textContent = 'üé§';
    };

    recognition.start();
  };

  /* ===============================
     TEMƒ∞ZLE
  ================================ */
  window.temizle = function () {
    sokakInput.value = '';
    resultDiv.classList.add('hidden');
  };

  /* ===============================
     SONU√á G√ñSTER
  ================================ */
  function gosterSonuc(tip, baslik, mesaj) {
    resultDiv.innerHTML = `
      <div class="result-box result-${tip}">
        <div class="result-title ${tip}-title">${baslik}</div>
        <div>${mesaj}</div>
      </div>
    `;
    resultDiv.classList.remove('hidden');
  }

  /* ===============================
     SOKAK Lƒ∞STESƒ∞
  ================================ */
  const sokakListesi = document.getElementById("sokakListesi");
  sokakListesi.innerHTML = '';

  Object.entries(sokaklar).forEach(([sokak, mahalle]) => {
    const item = document.createElement('div');
    item.className = 'list-item';
    item.innerHTML = `
      <div class="list-sokak">${sokak}</div>
      <div class="list-mahalle">${mahalle}</div>
    `;
    sokakListesi.appendChild(item);
  });

});
</script>
