<script>
/* ===============================
   SOKAK VERƒ∞TABANI (AYNI)
================================ */
const sokaklar = {
  'yemeni sokak': 'Ertuƒürul Gazi Mahallesi',
  '√ßayƒ±r sokak': 'Dumlupƒ±nar Mahallesi',
  'sekbanlƒ± sokak': 'Ataevler Mahallesi',
  'g√∂ksun sokak': 'ƒ∞stasyon Mahallesi',
  'cami sokak': 'Tepecik Mahallesi'
};

let dinliyor = false;

/* ===============================
   NORMALIZE
   yemeni / yemeni sk / yemeni sok
================================ */
function normalize(text) {
  return text
    .toLowerCase()
    .replace(/sok\.?/g, 'sokak')
    .replace(/sk/g, 'sokak')
    .replace(/\s+/g, ' ')
    .trim();
}

/* ===============================
   ENTER ƒ∞LE ARAMA
================================ */
document.getElementById('sokakInput').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') ara();
});

/* ===============================
   ANA ARAMA FONKSƒ∞YONU
================================ */
function ara() {
  const inputEl = document.getElementById('sokakInput');
  const resultDiv = document.getElementById('result');

  const girilen = inputEl.value;
  const aranan = normalize(girilen);

  if (!aranan) {
    gosterSonuc('error', '‚ùå Uyarƒ±', 'L√ºtfen bir sokak adƒ± girin!');
    return;
  }

  /* 1Ô∏è‚É£ TAM E≈ûLE≈ûME */
  if (sokaklar[aranan]) {
    gosterSonuc(
      'success',
      '‚úÖ Bulundu!',
      `<div class="sokak-name">${girilen}</div>
       <div class="mahalle-name">${sokaklar[aranan]}</div>`
    );
    sesliSoyle(sokaklar[aranan]);
    return;
  }

  /* 2Ô∏è‚É£ KISMƒ∞ E≈ûLE≈ûME
     yemeni ‚Üí yemeni sokak
     √ßayƒ±r ‚Üí √ßayƒ±r sokak
  */
  const eslesenSokak = Object.keys(sokaklar).find(sokak =>
    sokak.includes(aranan) ||
    aranan.includes(sokak.replace(' sokak', ''))
  );

  if (eslesenSokak) {
    gosterSonuc(
      'success',
      '‚úÖ Bulundu!',
      `<div class="sokak-name">${eslesenSokak}</div>
       <div class="mahalle-name">${sokaklar[eslesenSokak]}</div>`
    );
    sesliSoyle(sokaklar[eslesenSokak]);
  } else {
    gosterSonuc(
      'warning',
      '‚ö†Ô∏è Bulunamadƒ±',
      'Bu sokak veritabanƒ±nda bulunamadƒ±.'
    );
    sesliSoyle('Bulunamadƒ±');
  }
}

/* ===============================
   SESLƒ∞ OKUMA (AYNI)
================================ */
function sesliSoyle(metin) {
  window.speechSynthesis.cancel();
  const utterance = new SpeechSynthesisUtterance(metin);
  utterance.lang = 'tr-TR';
  utterance.rate = 1.1;
  utterance.pitch = 1;
  utterance.volume = 1;
  window.speechSynthesis.speak(utterance);
}

/* ===============================
   SESLƒ∞ ARAMA (G√úNCELLENDƒ∞)
================================ */
function sesliAra() {
  const SpeechRecognition =
    window.SpeechRecognition || window.webkitSpeechRecognition;

  if (!SpeechRecognition) {
    gosterSonuc('error', '‚ùå Uyarƒ±', 'Tarayƒ±cƒ±nƒ±z ses tanƒ±mayƒ± desteklemiyor.');
    sesliSoyle('Tarayƒ±cƒ±nƒ±z ses tanƒ±mayƒ± desteklemiyor.');
    return;
  }

  const recognition = new SpeechRecognition();
  recognition.lang = 'tr-TR';
  recognition.continuous = false;
  recognition.interimResults = false;

  const voiceBtn = document.getElementById('voiceBtn');

  recognition.onstart = () => {
    dinliyor = true;
    voiceBtn.classList.add('listening');
    voiceBtn.textContent = 'üî¥ Dinliyor...';
    gosterSonuc('listening', 'üé§ Dinliyorum', 'Sokak adƒ±nƒ± s√∂yleyin...');
  };

  recognition.onresult = (event) => {
    const sesliMetin = event.results[0][0].transcript;
    document.getElementById('sokakInput').value = sesliMetin;
    ara(); // ‚¨ÖÔ∏è ARTIK AYNI AKILLI MANTIK √áALI≈ûIYOR
  };

  recognition.onerror = () => {
    gosterSonuc('error', '‚ùå Hata', 'Ses tanƒ±ma hatasƒ±. L√ºtfen tekrar deneyin.');
    sesliSoyle('Ses tanƒ±ma hatasƒ±.');
  };

  recognition.onend = () => {
    dinliyor = false;
    voiceBtn.classList.remove('listening');
    voiceBtn.textContent = 'üé§';
  };

  recognition.start();
}

/* ===============================
   TEMƒ∞ZLE (AYNI)
================================ */
function temizle() {
  document.getElementById('sokakInput').value = '';
  document.getElementById('result').classList.add('hidden');
}

/* ===============================
   SONU√á G√ñSTER (AYNI)
================================ */
function gosterSonuc(tip, baslik, mesaj) {
  const resultDiv = document.getElementById('result');
  const tipClass = `result-${tip}`;
  const titleClass = `${tip}-title`;

  resultDiv.innerHTML = `
    <div class="result-box ${tipClass}">
      <div class="result-title ${titleClass}">${baslik}</div>
      <div>${mesaj}</div>
    </div>
  `;
  resultDiv.classList.remove('hidden');
}

/* ===============================
   SOKAK Lƒ∞STESƒ∞ (AYNI)
================================ */
function sokakListesiOlustur() {
  const liste = document.getElementById('sokakListesi');
  liste.innerHTML = '';

  Object.entries(sokaklar).forEach(([sokak, mahalle]) => {
    const item = document.createElement('div');
    item.className = 'list-item';
    item.innerHTML = `
      <div class="list-sokak">${sokak}</div>
      <div class="list-mahalle">${mahalle}</div>
    `;
    liste.appendChild(item);
  });
}

/* ===============================
   SAYFA Y√úKLENƒ∞NCE
================================ */
sokakListesiOlustur();
</script>
